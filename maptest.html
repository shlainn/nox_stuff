<!DOCTYPE html>
<html>
<head><title>map test</title>
</head>
<body style="background:black; color:#ddd">

<div style="float:left;padding: 20px;">
<canvas id="spacemap" style="width: 630px; height: 500px; border: 2px lime solid;" width=630 height=500 onmouseover="spacemap_tooltip_start()" onmouseout="spacemap_tooltip_stop()" onmousemove="spacemap_tooltip(event)" onclick="spacemap_click(event)"></canvas>
<canvas id="spacemap_click" style="width: 630px; height: 500px;border: 2px orange solid; display:none" width=630 height=500></canvas>
<div id=tooltip style="position: absolute; display:none;border: 2px cyan solid; padding:5px; background-color:#333"></div>
</div>

<div style="float:left;padding: 20px;">
Test einer alternativen Kartendarstellung<br>
<b>Mittelpunkt</b><br> X <input id="current_x" style="width:60px;"> Y <input id="current_y" style="width:60px;"> Z <input id="current_z" style="width:60px;"><br>
<b>Sichtweite</b></br> <input id="current_range" value=150><br>
<b>Drehung</b></br> <input id="current_angle" value=0><br>
<b>Darstellung</b></br>
Planetenradius min <input id="planet_min" value=4> max <input id="planet_max" value=15><br>
Sternenradius min <input id="star_min" value=8> max <input id="star_max" value=25><br>
<button onClick=redraw_from_values()>Neu zeichnen</button><br><br>
<a href=# onclick="zoom_in()" style="width:32px;height:32px;display:inline-block;background:url(icons.png) -444px -45px"></a>
<a href=# onclick="reset_view()" style="width:32px;height:32px;display:inline-block;background:url(icons.png) -484px -5px"></a>
<a href=# onclick="zoom_out()" style="width:32px;height:32px;display:inline-block;background:url(icons.png) -484px -45px"></a><br>
<a href=# onclick="rotate_left()" style="width:32px;height:32px;display:inline-block;background:url(icons.png) -324px -165px"></a>
<a href=# onclick="fleet_scan()" title="Scan Starten" style="width:32px;height:32px;display:inline-block;background:url(icons.png) -244px -205px"></a>
<a href=# onclick="rotate_right()" style="width:32px;height:32px;display:inline-block;background:url(icons.png) -364px -165px"></a><br>
<a href=# onclick="draw_fleet_positions()" title="Flotten Anzeigen(DEBUG)" style="width:32px;height:32px;display:inline-block;background:url(icons.png) -244px -245px"></a>
</div>


<script>
var sector_number = 3;
var fleets, myfleets, fleet_sectors, fleet_index;
var xleets = {
  "myFleets": [
    {
      "planetId": null,
      "id": "7412",
      "name": "flufluf",
      "state": "HangingAround",
      "mission": "NoMission",
      "canBeSupplied": 1,
      "canBeAttacked": 0,
      "canBeInspected": 0,
      "hiddenFleet": false,
      "isAlien": false,
      "destination": null,
      "currentPosX": "727.0",
      "currentPosY": "945.0",
      "currentPosZ": "1032.0",
      "currentGalaxyId": null
    },
    {
      "planetId": null,
      "id": "7374",
      "name": "Gu",
      "state": "HangingAround",
      "mission": "NoMission",
      "canBeSupplied": 1,
      "canBeAttacked": 0,
      "canBeInspected": 0,
      "hiddenFleet": false,
      "isAlien": false,
      "destination": null,
      "currentPosX": "729.0",
      "currentPosY": "962.0",
      "currentPosZ": "1066.0",
      "currentGalaxyId": null
    },
    {
      "planetId": null,
      "id": "7470",
      "name": "Mimimi",
      "state": "HangingAround",
      "mission": "NoMission",
      "canBeSupplied": 1,
      "canBeAttacked": 0,
      "canBeInspected": 0,
      "hiddenFleet": false,
      "isAlien": false,
      "destination": null,
      "currentPosX": "727.0",
      "currentPosY": "945.0",
      "currentPosZ": "1032.0",
      "currentGalaxyId": null
    }
  ],
  "foreignFleets": [
    {
      "planetId": null,
      "id": "5378",
      "name": "FlotteI",
      "state": "AtHome",
      "onVacation": "0",
      "mission": "NoMission",
      "canBeSupplied": 0,
      "canBeAttacked": 0,
      "canBeInspected": 0,
      "hiddenFleet": false,
      "isAlien": false,
      "destination": null,
      "currentPosX": "651.0",
      "currentPosY": "999.0",
      "currentPosZ": "1060.0"
    },
    {
      "planetId": null,
      "id": "5413",
      "name": "Fl_1",
      "state": "AtHome",
      "onVacation": "0",
      "mission": "NoMission",
      "canBeSupplied": 0,
      "canBeAttacked": 0,
      "canBeInspected": 0,
      "hiddenFleet": false,
      "isAlien": false,
      "destination": null,
      "currentPosX": "639.0",
      "currentPosY": "966.0",
      "currentPosZ": "1071.0"
    }
  ]
};

var positions = [["PGC 58314","Sol-1","S-Ora1","275","730","203"],
["PGC 58314","Sol-11","S-Red1","848","558","988"],
["PGC 58314","Sol-12","S-Yel1","453","1002","608"],
["PGC 58314","Sol-14","S-Red1","766","339","318"],
["PGC 58314","Sol-15","S-Yel1","528","798","395"],
["PGC 58314","Sol-16","S-Ora1","654","975","993"],
["PGC 58314","Sol-17","S-Red1","945","647","497"],
["PGC 58314","Sol-18","S-Red1","97","673","264"],
["PGC 58314","Sol-19","S-Yel1","197","1000","137"],
["PGC 58314","Sol-2","S-Red1","522","591","714"],
["PGC 58314","Sol-20","S-Yel1","824","784","288"],
["PGC 58314","Sol-21","S-Red1","672","526","337"],
["PGC 58314","Sol-22","S-Red1","904","689","125"],
["PGC 58314","Sol-23","S-Ora1","879","608","814"],
["PGC 58314","Sol-24","S-Ora1","1008","1007","866"],
["PGC 58314","Sol-25","S-Yel1","100","425","199"],
["PGC 58314","Sol-3","S-Red1","947","244","569"],
["PGC 58314","Sol-4","S-Red1","444","452","501"],
["PGC 58314","Sol-5","S-Yel1","424","400","214"],
["PGC 58314","Sol-6","S-Ora1","191","674","395"],
["PGC 58314","Sol-7","S-Yel1","270","845","495"],
["PGC 58314","Sol-8","S-Yel1","932","568","319"],
["PGC 58314","Sol-1","P-Des19","290","762","249"],
["PGC 58314","Sol-1","P-Fir1","350","672","239"],
["PGC 58314","Sol-1","P-FirX","284","775","239"],
["PGC 58314","Sol-1","P-Sto2","323","676","234"],
["PGC 58314","Sol-1","P-FirX","234","786","233"],
["PGC 58314","Sol-1","P-Sto10","304","714","221"],
["PGC 58314","Sol-1","P-Des15","313","741","220"],
["PGC 58314","Sol-1","P-Wat9","230","710","219"],
["PGC 58314","Sol-1","P-FirX","343","796","218"],
["PGC 58314","Sol-1","P-Sto17","308","752","212"],
["PGC 58314","Sol-1","P-Des7","272","700","209"],
["PGC 58314","Sol-1","P-Sto8","312","706","206"],
["PGC 58314","Sol-1","P-Sto13","342","730","205"],
["PGC 58314","Sol-1","P-Wat4","230","684","204"],
["PGC 58314","Sol-1","P-FirX","288","790","198"],
["PGC 58314","Sol-1","P-Sto5","264","690","188"],
["PGC 58314","Sol-1","P-Wat6","270","694","180"],
["PGC 58314","Sol-1","P-Jun14","231","734","179"],
["PGC 58314","Sol-1","P-Des11","343","719","175"],
["PGC 58314","Sol-1","P-Des16","281","746","172"],
["PGC 58314","Sol-1","P-Wat21","337","771","169"],
["PGC 58314","Sol-1","P-Jun3","264","680","168"],
["PGC 58314","Sol-1","P-FirX","339","780","166"],
["PGC 58314","Sol-1","P-Des18","223","758","165"],
["PGC 58314","Sol-10","Arkadia","878","212","191"],
["PGC 58314","Sol-10","P-Ext28","762","177","184"],
["PGC 58314","Sol-10","P-Wat22","836","206","155"],
["PGC 58314","Sol-10","P-Wat19","780","185","136"],
["PGC 58314","Sol-10","P-Fir18","769","173","129"],
["PGC 58314","Sol-10","P-FirX","820","210","118"],
["PGC 58314","Sol-10","P-Sto15","877","200","114"],
["PGC 58314","Sol-10","P-Sto12","776","213","95"],
["PGC 58314","Sol-10","P-Des10","712","211","85"],
["PGC 58314","Sol-11","P-Ext26","899","585","1062"],
["PGC 58314","Sol-11","P-Ext25","916","532","1057"],
["PGC 58314","Sol-11","P-Ext24","892","597","1050"],
["PGC 58314","Sol-11","P-Ext23","823","527","1045"],
["PGC 58314","Sol-11","P-Des22","839","547","1041"],
["PGC 58314","Sol-11","P-FirX","849","567","1034"],
["PGC 58314","Sol-11","P-Ext19","893","571","1025"],
["PGC 58314","Sol-11","Aquaria","840","548","1018"],
["PGC 58314","Sol-11","P-Fir17","856","532","1013"],
["PGC 58314","Sol-11","P-Wat15","840","600","1002"],
["PGC 58314","Sol-11","P-Jun14","822","539","995"],
["PGC 58314","Sol-11","P-Fir12","830","587","983"],
["PGC 58314","Sol-11","P-Wat11","851","537","978"],
["PGC 58314","Sol-11","P-Ext10","908","550","974"],
["PGC 58314","Sol-11","P-Sto9","837","555","969"],
["PGC 58314","Sol-11","P-Des8","897","541","963"],
["PGC 58314","Sol-11","P-Fir5","825","581","949"],
["PGC 58314","Sol-11","P-Fir4","834","526","945"],
["PGC 58314","Sol-11","P-Fir3","825","533","940"],
["PGC 58314","Sol-11","P-FirX","858","538","933"],
["PGC 58314","Sol-11","P-Fir1","802","580","929"],
["PGC 58314","Sol-12","P-Wat11","412","988","673"],
["PGC 58314","Sol-12","P-Jun9","539","976","672"],
["PGC 58314","Sol-12","P-Ext25","510","1064","672"],
["PGC 58314","Sol-12","P-Sto23","431","1054","665"],
["PGC 58314","Sol-12","P-Jun22","434","1048","662"],
["PGC 58314","Sol-12","P-Fir6","525","963","659"],
["PGC 58314","Sol-12","P-Sto8","514","971","657"],
["PGC 58314","Sol-12","P-Fir24","521","1059","656"],
["PGC 58314","Sol-12","P-Sto13","393","998","653"],
["PGC 58314","Sol-12","P-Fir5","490","956","651"],
["PGC 58314","Sol-12","P-Jun12","395","994","651"],
["PGC 58314","Sol-12","P-Des16","520","1014","650"],
["PGC 58314","Sol-12","b12","459","1010","649"],
["PGC 58314","Sol-12","P-Ext27","382","1076","645"],
["PGC 58314","Sol-12","P-Ext26","503","1070","644"],
["PGC 58314","Sol-12","P-Des7","528","967","643"],
["PGC 58314","Sol-12","P-Des4","401","952","639"],
["PGC 58314","Sol-12","P-Ext19","380","1033","610"],
["PGC 58314","Sol-12","P-Fir1","533","935","600"],
["PGC 58314","Sol-12","P-Des18","451","1027","599"],
["PGC 58314","Sol-12","P-Fir14","508","1004","597"],
["PGC 58314","Sol-12","P-Jun17","479","1021","568"],
["PGC 58314","Sol-12","P-Sto20","507","1037","568"],
["PGC 58314","Sol-12","P-Ext28","471","1083","566"],
["PGC 58314","Sol-12","P-Fir2","401","940","566"],
["PGC 58314","Sol-12","P-Jun3","520","947","559"],
["PGC 58314","Sol-14","Deimos","840","363","372"],
["PGC 58314","Sol-14","Aldebaran","835","317","366"],
["PGC 58314","Sol-14","P-Sto10","801","334","353"],
["PGC 58314","Sol-14","P-Fir8","721","324","351"],
["PGC 58314","Sol-14","P-Wat19","749","379","349"],
["PGC 58314","Sol-14","P-Wat6","722","313","340"],
["PGC 58314","Sol-14","P-Ext4","760","302","339"],
["PGC 58314","Sol-14","P-Ext22","752","394","333"],
["PGC 58314","Sol-14","P-Sto14","844","355","333"],
["PGC 58314","Sol-14","P-Ext21","800","390","327"],
["PGC 58314","Sol-14","P-FirX","720","339","325"],
["PGC 58314","Sol-14","K1","793","399","324"],
["PGC 58314","Sol-14","P-Des15","729","359","321"],
["PGC 58314","Sol-14","P-Wat12","751","344","316"],
["PGC 58314","Sol-14","P-Des2","810","292","316"],
["PGC 58314","Sol-14","P-Wat18","757","375","305"],
["PGC 58314","Sol-14","P-Sto9","738","329","304"],
["PGC 58314","Sol-14","P-Des13","745","348","301"],
["PGC 58314","Sol-14","P-Fir5","838","309","300"],
["PGC 58314","Sol-14","P-Ext24","747","405","296"],
["PGC 58314","Sol-14","P-Sto20","791","383","283"],
["PGC 58314","Sol-14","P-Fir1","800","288","278"],
["PGC 58314","Sol-14","P-Fir3","789","298","276"],
["PGC 58314","Sol-15","P-Sto7","501","765","446"],
["PGC 58314","Sol-15","P-Wat21","494","850","445"],
["PGC 58314","Sol-15","P-Ext25","527","874","441"],
["PGC 58314","Sol-15","P-Des17","585","827","441"],
["PGC 58314","Sol-15","P-Jun15","560","815","440"],
["PGC 58314","Sol-15","P-Ext5","518","751","437"],
["PGC 58314","Sol-15","P-Jun16","539","822","434"],
["PGC 58314","Sol-15","P-Ext23","545","864","434"],
["PGC 58314","Sol-15","P-Ext6","566","758","428"],
["PGC 58314","Sol-15","P-Fir1","510","731","428"],
["PGC 58314","Sol-15","P-Sto11","526","789","425"],
["PGC 58314","Sol-15","P-Ext19","478","837","424"],
["PGC 58314","Sol-15","P-Ext24","552","869","422"],
["PGC 58314","Sol-15","P-Jun8","605","772","414"],
["PGC 58314","Sol-15","P-Sto4","580","746","414"],
["PGC 58314","Sol-15","P-Fir14","592","808","409"],
["PGC 58314","Sol-15","P-Sto12","549","796","407"],
["PGC 58314","Sol-15","P-Ext22","472","857","405"],
["PGC 58314","Sol-15","P-Jun9","518","777","398"],
["PGC 58314","Sol-15","P-Sto2","561","735","398"],
["PGC 58314","Sol-15","P-Sto3","602","739","394"],
["PGC 58314","Sol-15","P-Fir10","469","782","393"],
["PGC 58314","Sol-15","P-Des18","518","832","389"],
["PGC 58314","Sol-15","P-Sto13","541","803","389"],
["PGC 58314","Sol-16","P-Ext23","649","997","1058"],
["PGC 58314","Sol-16","P-Ext22","647","1012","1051"],
["PGC 58314","Sol-16","P-Ext21","718","1012","1045"],
["PGC 58314","Sol-16","P-Ext25","637","984","1038"],
["PGC 58314","Sol-16","P-Jun19","727","945","1032"],
["PGC 58314","Sol-16","P-Sto18","692","971","1025"],
["PGC 58314","Sol-16","P-Fir17","606","942","1018"],
["PGC 58314","Sol-16","P-Ext16","595","934","1011"],
["PGC 58314","Sol-16","P-Fir15","632","983","1007"],
["PGC 58314","Sol-16","P-Fir14","624","962","1001"],
["PGC 58314","Sol-16","P-Wat13","711","1027","997"],
["PGC 58314","Sol-16","P-Jun11","686","1021","984"],
["PGC 58314","Sol-16","P-Jun10","610","986","979"],
["PGC 58314","Sol-16","P-Sto9","705","1029","973"],
["PGC 58314","Sol-16","TeamSupportLookout","664","961","967"],
["PGC 58314","Sol-16","P-Des7","621","1036","961"],
["PGC 58314","Sol-16","P-Sto6","614","1016","956"],
["PGC 58314","Sol-16","P-Des5","603","1020","949"],
["PGC 58314","Sol-16","P-Ext4","688","926","943"],
["PGC 58314","Sol-16","P-Des3","681","1014","937"],
["PGC 58314","Sol-16","P-Fir1","670","963","927"],
["PGC 58314","Sol-17","P-Des24","998","588","553"],
["PGC 58314","Sol-17","P-Jun14","941","738","550"],
["PGC 58314","Sol-17","P-Sto4","886","684","545"],
["PGC 58314","Sol-17","P-Wat21","985","672","542"],
["PGC 58314","Sol-17","P-Jun18","965","605","533"],
["PGC 58314","Sol-17","P-Sto2","876","722","527"],
["PGC 58314","Sol-17","P-Des9","914","668","520"],
["PGC 58314","Sol-17","P-Fir1","871","723","518"],
["PGC 58314","Sol-17","P-Jun8","908","604","514"],
["PGC 58314","Sol-17","P-Wat5","890","611","510"],
["PGC 58314","Sol-17","P-Jun17","959","665","499"],
["PGC 58314","Sol-17","P-Fir10","920","738","484"],
["PGC 58314","Sol-17","P-Ext26","1011","725","484"],
["PGC 58314","Sol-17","P-Jun20","979","717","481"],
["PGC 58314","Sol-17","P-Ext16","954","708","477"],
["PGC 58314","Sol-17","P-Ext28","1020","667","471"],
["PGC 58314","Sol-17","P-Ext29","1027","682","468"],
["PGC 58314","Sol-17","P-Des23","994","685","468"],
["PGC 58314","Sol-17","P-Ext27","1016","718","464"],
["PGC 58314","Sol-17","P-Ext25","1004","621","462"],
["PGC 58314","Sol-17","P-Des7","901","690","458"],
["PGC 58314","Sol-17","P-Sto12","931","679","453"],
["PGC 58314","Sol-18","P-Ext25","84","656","336"],
["PGC 58314","Sol-18","P-Ext24","171","716","331"],
["PGC 58314","Sol-18","P-Ext23","151","656","325"],
["PGC 58314","Sol-18","P-Ext22","153","682","321"],
["PGC 58314","Sol-18","P-Ext21","142","686","317"],
["PGC 58314","Sol-18","P-Fir19","90","713","309"],
["PGC 58314","Sol-18","P-Des18","69","664","303"],
["PGC 58314","Sol-18","P-FirX","123","666","296"],
["PGC 58314","Sol-18","P-Fir16","78","681","291"],
["PGC 58314","Sol-18","P-Wat15","116","723","284"],
["PGC 58314","Sol-18","Ganymed","116","671","278"],
["PGC 58314","Sol-18","Pandora","112","673","269"],
["PGC 58314","Sol-18","P-Des11","147","669","264"],
["PGC 58314","Sol-18","P-Wat10","95","704","257"],
["PGC 58314","Sol-18","P-Jun8","98","711","244"],
["PGC 58314","Sol-18","P-Fir7","89","643","237"],
["PGC 58314","Sol-18","P-Ext6","168","673","233"],
["PGC 58314","Sol-18","P-Fir5","118","689","226"],
["PGC 58314","Sol-18","P-Ext4","60","688","222"],
["PGC 58314","Sol-18","P-Fir3","110","675","216"],
["PGC 58314","Sol-18","P-Wat2","145","686","212"],
["PGC 58314","Sol-18","P-Fir1","66","649","207"],
["PGC 58314","Sol-19","P-Ext19","179","1035","190"],
["PGC 58314","Sol-19","P-Sto16","215","1076","182"],
["PGC 58314","Sol-19","P-Sto22","245","930","181"],
["PGC 58314","Sol-19","P-Sto12","191","976","175"],
["PGC 58314","Sol-19","P-Des23","252","1011","173"],
["PGC 58314","Sol-19","P-Sto17","220","1023","168"],
["PGC 58314","Sol-19","P-Fir6","158","1078","163"],
["PGC 58314","Sol-19","P-Wat11","184","1063","162"],
["PGC 58314","Sol-19","P-Sto3","145","963","158"],
["PGC 58314","Sol-19","P-Jun14","202","1084","151"],
["PGC 58314","Sol-19","P-Des2","139","952","149"],
["PGC 58314","Sol-19","P-Des19","230","930","144"],
["PGC 58314","Sol-19","P-Ext25","264","1035","142"],
["PGC 58314","Sol-19","P-Ext24","257","943","139"],
["PGC 58314","Sol-19","K4","150","930","131"],
["PGC 58314","Sol-19","P-Fir21","239","1047","123"],
["PGC 58314","Sol-19","P-Fir8","168","948","117"],
["PGC 58314","Sol-19","P-Ext27","277","947","116"],
["PGC 58314","Sol-19","P-Fir1","132","994","112"],
["PGC 58314","Sol-19","P-Fir13","196","983","110"],
["PGC 58314","Sol-19","P-Sto20","234","1003","107"],
["PGC 58314","Sol-19","P-Ext26","270","1039","105"],
["PGC 58314","Sol-19","P-Des15","209","1066","97"],
["PGC 58314","Sol-19","P-Jun5","154","937","94"],
["PGC 58314","Sol-19","P-Des7","162","966","93"],
["PGC 58314","Sol-2","P-Wat19","553","538","778"],
["PGC 58314","Sol-2","P-Fir9","495","547","771"],
["PGC 58314","Sol-2","P-Des10","502","673","771"],
["PGC 58314","Sol-2","P-Ext8","490","632","759"],
["PGC 58314","Sol-2","P-Ext24","581","632","752"],
["PGC 58314","Sol-2","P-Sto20","558","532","744"],
["PGC 58314","Sol-2","P-Ext28","603","580","739"],
["PGC 58314","Sol-2","P-Fir6","477","619","739"],
["PGC 58314","Sol-2","P-Des23","574","551","735"],
["PGC 58314","Sol-2","P-Ext11","506","663","734"],
["PGC 58314","Sol-2","P-Des3","457","519","731"],
["PGC 58314","Sol-2","P-Des5","470","681","723"],
["PGC 58314","Sol-2","P-FirX","614","528","723"],
["PGC 58314","Sol-2","P-Fir18","549","521","712"],
["PGC 58314","Sol-2","P-FirX","609","605","701"],
["PGC 58314","Sol-2","P-Jun7","483","582","701"],
["PGC 58314","Sol-2","P-FirX","595","632","700"],
["PGC 58314","Sol-2","P-Jun2","451","641","688"],
["PGC 58314","Sol-2","P-Fir21","563","515","685"],
["PGC 58314","Sol-2","P-Sto25","588","531","684"],
["PGC 58314","Sol-2","P-Sto4","463","595","679"],
["PGC 58314","Sol-2","P-Des15","530","595","675"],
["PGC 58314","Sol-2","P-Sto13","517","640","675"],
["PGC 58314","Sol-2","P-Sto12","511","614","670"],
["PGC 58314","Sol-2","P-Fir1","444","511","666"],
["PGC 58314","Sol-2","P-FirX","599","535","664"],
["PGC 58314","Sol-2","P-Ext22","568","673","661"],
["PGC 58314","Sol-2","P-Jun16","536","643","661"],
["PGC 58314","Sol-20","P-Ext29","781","863","343"],
["PGC 58314","Sol-20","P-Sto22","807","825","341"],
["PGC 58314","Sol-20","P-Ext26","761","848","340"],
["PGC 58314","Sol-20","P-Sto7","790","745","334"],
["PGC 58314","Sol-20","P-Sto6","882","740","330"],
["PGC 58314","Sol-20","P-Ext19","780","809","327"],
["PGC 58314","Sol-20","P-Wat15","879","788","327"],
["PGC 58314","Sol-20","P-Sto3","835","725","325"],
["PGC 58314","Sol-20","P-Fir8","786","752","316"],
["PGC 58314","Sol-20","P-Fir1","865","715","312"],
["PGC 58314","Sol-20","P-Ext18","913","803","307"],
["PGC 58314","Sol-20","P-Fir17","896","799","302"],
["PGC 58314","Sol-20","P-Fir12","838","770","302"],
["PGC 58314","Sol-20","P-Des24","876","838","301"],
["PGC 58314","Sol-20","P-Wat21","862","821","299"],
["PGC 58314","Sol-20","P-Des16","878","794","286"],
["PGC 58314","Sol-20","P-Sto11","782","765","283"],
["PGC 58314","Sol-20","P-Fir5","833","734","273"],
["PGC 58314","Sol-20","P-Ext25","844","844","273"],
["PGC 58314","Sol-20","P-Ext27","848","852","266"],
["PGC 58314","Sol-20","P-Jun9","805","757","262"],
["PGC 58314","Sol-20","P-Ext23","844","832","262"],
["PGC 58314","Sol-20","P-Des2","840","721","252"],
["PGC 58314","Sol-20","P-FirX","846","856","252"],
["PGC 58314","Sol-20","P-Sto20","777","816","252"],
["PGC 58314","Sol-21","P-Fir12","675","476","381"],
["PGC 58314","Sol-21","P-Fir11","670","493","380"],
["PGC 58314","Sol-21","P-Ext21","723","545","373"],
["PGC 58314","Sol-21","P-Wat3","623","596","372"],
["PGC 58314","Sol-21","P-Sto13","679","519","371"],
["PGC 58314","Sol-21","P-Wat16","696","594","365"],
["PGC 58314","Sol-21","P-Fir1","613","591","362"],
["PGC 58314","Sol-21","P-Sto9","659","501","348"],
["PGC 58314","Sol-21","P-Jun6","643","592","348"],
["PGC 58314","Sol-21","P-Jun5","636","496","344"],
["PGC 58314","Sol-21","P-Fir4","630","585","341"],
["PGC 58314","Sol-21","P-FirX","727","473","341"],
["PGC 58314","Sol-21","P-Ext7","648","582","341"],
["PGC 58314","Sol-21","P-Ext23","733","467","339"],
["PGC 58314","Sol-21","P-Des14","685","512","332"],
["PGC 58314","Sol-21","P-Jun19","711","561","328"],
["PGC 58314","Sol-21","P-Fir20","718","574","325"],
["PGC 58314","Sol-21","P-Ext25","744","495","321"],
["PGC 58314","Sol-21","P-Ext8","652","475","319"],
["PGC 58314","Sol-21","P-Jun17","700","590","318"],
["PGC 58314","Sol-21","P-Sto15","691","481","310"],
["PGC 58314","Sol-21","P-Fir10","664","492","310"],
["PGC 58314","Sol-21","P-Ext24","739","464","302"],
["PGC 58314","Sol-21","P-Jun2","617","586","301"],
["PGC 58314","Sol-22","P-Ext26","837","760","166"],
["PGC 58314","Sol-22","P-Ext27","860","767","159"],
["PGC 58314","Sol-22","P-Sto21","898","734","157"],
["PGC 58314","Sol-22","P-Jun9","900","667","155"],
["PGC 58314","Sol-22","P-Fir5","932","643","150"],
["PGC 58314","Sol-22","P-Wat2","876","625","147"],
["PGC 58314","Sol-22","P-Sto20","929","728","134"],
["PGC 58314","Sol-22","P-Des132","883","688","134"],
["PGC 58314","Sol-22","P-Sto22","989","740","132"],
["PGC 58314","Sol-22","P-Ext12","973","681","130"],
["PGC 58314","Sol-22","P-Wat6","900","649","124"],
["PGC 58314","Sol-22","P-Sto8","868","660","121"],
["PGC 58314","Sol-22","P-Jun19","876","723","121"],
["PGC 58314","Sol-22","P-Ext25","897","756","116"],
["PGC 58314","Sol-22","P-Ext28","987","771","115"],
["PGC 58314","Sol-22","P-Wat4","851","636","109"],
["PGC 58314","Sol-22","P-Fir1","935","620","107"],
["PGC 58314","Sol-22","P-Wat10","923","671","104"],
["PGC 58314","Sol-22","P-Fir7","849","751","99"],
["PGC 58314","Sol-22","P-Jun23","985","746","96"],
["PGC 58314","Sol-22","P-Fir15","928","701","89"],
["PGC 58314","Sol-23","P-Des1322","966","621","897"],
["PGC 58314","Sol-23","P-Ext29","837","636","892"],
["PGC 58314","Sol-23","P-Ext28","896","572","886"],
["PGC 58314","Sol-23","P-Ext27","961","621","881"],
["PGC 58314","Sol-23","P-Ext26","898","579","874"],
["PGC 58314","Sol-23","P-Ext25","825","581","870"],
["PGC 58314","Sol-23","P-Sto24","880","628","864"],
["PGC 58314","Sol-23","P-FirX","967","663","860"],
["PGC 58314","Sol-23","P-Des1323","927","661","855"],
["PGC 58314","Sol-23","P-Sto21","960","635","851"],
["PGC 58314","Sol-23","P-Des20","919","582","847"],
["PGC 58314","Sol-23","P-Sto19","833","621","840"],
["PGC 58314","Sol-23","P-FirX","864","593","836"],
["PGC 58314","Sol-23","P-Fir15","927","569","820"],
["PGC 58314","Sol-23","P-Ext14","963","566","813"],
["PGC 58314","Sol-23","P-FirX","833","571","808"],
["PGC 58314","Sol-23","P-Sto12","867","608","803"],
["PGC 58314","Sol-23","P-Fir11","821","638","797"],
["PGC 58314","Sol-23","P-Des10","957","633","790"],
["PGC 58314","Sol-23","P-Sto9","843","621","784"],
["PGC 58314","Sol-23","P-Fir8","898","626","778"],
["PGC 58314","Sol-23","P-Fir6","975","606","768"],
["PGC 58314","Sol-23","P-FirX","938","575","764"],
["PGC 58314","Sol-23","P-Des4","928","627","758"],
["PGC 58314","Sol-23","P-Wat3","817","590","754"],
["PGC 58314","Sol-23","P-Ext2","961","662","750"],
["PGC 58314","Sol-23","P-Fir1","844","568","746"],
["PGC 58314","Sol-24","P-Sto20","1051","1037","918"],
["PGC 58314","Sol-24","P-Des13","1040","997","917"],
["PGC 58314","Sol-24","P-Des132","982","987","917"],
["PGC 58314","Sol-24","P-Des21","1092","1043","909"],
["PGC 58314","Sol-24","P-Sto6","1017","958","906"],
["PGC 58314","Sol-24","P-FirX","1100","1096","892"],
["PGC 58314","Sol-24","P-Fir23","1001","1055","891"],
["PGC 58314","Sol-24","P-Wat19","938","1031","887"],
["PGC 58314","Sol-24","P-Fir14","1000","1003","887"],
["PGC 58314","Sol-24","P-Fir18","1093","1024","885"],
["PGC 58314","Sol-24","P-Ext29","979","1092","885"],
["PGC 58314","Sol-24","P-Des3","1079","943","881"],
["PGC 58314","Sol-24","P-Fir5","980","953","879"],
["PGC 58314","Sol-24","P-Fir55","957","1074","877"],
["PGC 58314","Sol-24","P-Sto12","981","992","871"],
["PGC 58314","Sol-24","P-Jun2","1053","936","869"],
["PGC 58314","Sol-24","P-FirX","1073","1085","868"],
["PGC 58314","Sol-24","P-Sto22","1039","1049","867"],
["PGC 58314","Sol-24","P-Fir25","1082","1067","861"],
["PGC 58314","Sol-24","P-Ext27","984","1078","855"],
["PGC 58314","Sol-24","P-Jun7","967","964","841"],
["PGC 58314","Sol-24","P-Fir1","1018","929","840"],
["PGC 58314","Sol-24","P-Sto24","1092","1062","836"],
["PGC 58314","Sol-24","P-Wat8","1073","970","831"],
["PGC 58314","Sol-24","P-Ext10","1092","980","829"],
["PGC 58314","Sol-24","P-Jun15","981","1010","824"],
["PGC 58314","Sol-24","P-Wat17","1018","1020","823"],
["PGC 58314","Sol-25","P-Ext25","141","403","267"],
["PGC 58314","Sol-25","P-Fir154","175","425","263"],
["PGC 58314","Sol-25","P-Ext23","46","389","256"],
["PGC 58314","Sol-25","P-FirX","84","386","251"],
["PGC 58314","Sol-25","P-FirX","113","394","241"],
["PGC 58314","Sol-25","P-Sto19","114","394","237"],
["PGC 58314","Sol-25","P-Des18","126","397","231"],
["PGC 58314","Sol-25","P-Des17","70","474","227"],
["PGC 58314","Sol-25","P-Ext16","89","396","223"],
["PGC 58314","Sol-25","P-Fir15","145","438","219"],
["PGC 58314","Sol-25","P-Fir152","140","444","213"],
["PGC 58314","Sol-25","P-Fir13","141","430","208"],
["PGC 58314","Sol-25","P-Ext12","65","417","203"],
["PGC 58314","Sol-25","P-Jun11","53","434","197"],
["PGC 58314","Sol-25","P-Ext10","112","435","190"],
["PGC 58314","Sol-25","P-Jun9","52","476","184"],
["PGC 58314","Sol-25","P-Ext8","136","472","180"],
["PGC 58314","Sol-25","P-Fir7","71","476","176"],
["PGC 58314","Sol-25","P-Fir6","148","416","170"],
["PGC 58314","Sol-25","P-Ext3","154","414","156"],
["PGC 58314","Sol-25","P-Wat2","98","382","150"],
["PGC 58314","Sol-25","P-Fir1","148","444","143"],
["PGC 58314","Sol-3","P-Ext24","1016","213","636"],
["PGC 58314","Sol-3","P-Fir11","950","243","629"],
["PGC 58314","Sol-3","Ext242","904","228","623"],
["PGC 58314","Sol-3","P-Fir12","909","213","617"],
["PGC 58314","Sol-3","P-Des19","1016","215","604"],
["PGC 58314","Sol-3","P-Sto18","923","295","600"],
["PGC 58314","Sol-3","P-Des17","969","209","595"],
["PGC 58314","Sol-3","P-Wat15","981","239","586"],
["PGC 58314","Sol-3","P-Sto14","898","236","579"],
["PGC 58314","Sol-3","P-Fir13","905","252","573"],
["PGC 58314","Sol-3","P-Fir12","978","270","568"],
["PGC 58314","Sol-3","P-Ext11","1015","210","561"],
["PGC 58314","Sol-3","P-Sto10","941","214","555"],
["PGC 58314","Sol-3","P-Fir9","911","256","551"],
["PGC 58314","Sol-3","P-Sto7","1020","296","541"],
["PGC 58314","Sol-3","P-Sto6","959","224","537"],
["PGC 58314","Sol-3","P-Sto5","1024","245","533"],
["PGC 58314","Sol-3","P-Fir4","917","292","527"],
["PGC 58314","Sol-3","P-Fir3","960","215","523"],
["PGC 58314","Sol-3","P-Fir1","897","235","511"],
["PGC 58314","Sol-4","P-Ext27","528","447","578"],
["PGC 58314","Sol-4","P-Ext26","456","421","574"],
["PGC 58314","Sol-4","P-Ext25","508","420","570"],
["PGC 58314","Sol-4","P-Ext24","443","428","565"],
["PGC 58314","Sol-4","P-Ext23","387","457","559"],
["PGC 58314","Sol-4","P-Wat22","478","499","553"],
["PGC 58314","Sol-4","P-Ext21","432","419","546"],
["PGC 58314","Sol-4","P-Jun20","515","479","541"],
["PGC 58314","Sol-4","P-Fir18","445","498","529"],
["PGC 58314","Sol-4","P-Wat15","477","431","513"],
["PGC 58314","Sol-4","P-Wat14","456","460","506"],
["PGC 58314","Sol-4","P-Ext13","507","448","502"],
["PGC 58314","Sol-4","P-Ext11","456","473","490"],
["PGC 58314","Sol-4","P-Ext112","459","475","484"],
["PGC 58314","Sol-4","P-Wat9","417","456","479"],
["PGC 58314","Sol-4","P-Wat8","501","426","474"],
["PGC 58314","Sol-4","P-Fir7","441","480","470"],
["PGC 58314","Sol-4","P-Sto6","510","505","465"],
["PGC 58314","Sol-4","P-Sto5","509","476","459"],
["PGC 58314","Sol-4","P-Ext4","427","423","452"],
["PGC 58314","Sol-4","P-Wat2","390","480","439"],
["PGC 58314","Sol-4","P-Fir1","501","459","432"],
["PGC 58314","Sol-5","P-Ext21","475","375","260"],
["PGC 58314","Sol-5","P-Ext12","423","441","259"],
["PGC 58314","Sol-5","P-Des18","454","405","255"],
["PGC 58314","Sol-5","P-FirX","482","388","251"],
["PGC 58314","Sol-5","P-Wat10","412","342","248"],
["PGC 58314","Sol-5","P-Fir17","449","357","240"],
["PGC 58314","Sol-5","P-Jun6","387","362","240"],
["PGC 58314","Sol-5","P-Jun4","378","445","239"],
["PGC 58314","Sol-5","P-FirX","488","342","239"],
["PGC 58314","Sol-5","P-Jun9","405","370","237"],
["PGC 58314","Sol-5","P-Jun13","429","452","228"],
["PGC 58314","Sol-5","P-Wat11","416","359","225"],
["PGC 58314","Sol-5","P-FirX","497","421","225"],
["PGC 58314","Sol-5","P-Ext24","493","452","220"],
["PGC 58314","Sol-5","P-Sto16","445","421","215"],
["PGC 58314","Sol-5","P-Des8","400","451","215"],
["PGC 58314","Sol-5","P-Fir1","363","448","215"],
["PGC 58314","Sol-5","P-Sto20","468","413","211"],
["PGC 58314","Sol-5","P-Wat7","394","465","205"],
["PGC 58314","Sol-5","P-Fir2","368","473","204"],
["PGC 58314","Sol-5","P-Jun15","439","474","180"],
["PGC 58314","Sol-6","P-Ext17","153","699","456"],
["PGC 58314","Sol-6","P-Ext5","171","636","455"],
["PGC 58314","Sol-6","P-Fir2","132","721","441"],
["PGC 58314","Sol-6","P-Wat15","133","690","432"],
["PGC 58314","Sol-6","P-Des16","199","694","431"],
["PGC 58314","Sol-6","P-Ext22","140","728","429"],
["PGC 58314","Sol-6","P-Fir9","133","657","423"],
["PGC 58314","Sol-6","P-Des13","188","682","419"],
["PGC 58314","Sol-6","P-Fir7","137","646","419"],
["PGC 58314","Sol-6","P-Fir14","136","686","412"],
["PGC 58314","Sol-6","P-Fir1","147","615","403"],
["PGC 58314","Sol-6","P-Wat10","223","664","398"],
["PGC 58314","Sol-6","P-Fir2","207","620","398"],
["PGC 58314","Sol-6","P-Ext24","147","737","393"],
["PGC 58314","Sol-6","P-Ext23","158","733","390"],
["PGC 58314","Sol-6","P-Ext3","183","624","375"],
["PGC 58314","Sol-6","P-Sto12","202","675","375"],
["PGC 58314","Sol-6","P-Ext20","265","715","374"],
["PGC 58314","Sol-6","P-Ext25","225","743","368"],
["PGC 58314","Sol-6","P-Jun6","190","642","367"],
["PGC 58314","Sol-6","P-Fir18","184","704","364"],
["PGC 58314","Sol-6","P-Sto19","216","709","352"],
["PGC 58314","Sol-6","P-Jun11","226","669","345"],
["PGC 58314","Sol-7","P-Ext29","190","822","577"],
["PGC 58314","Sol-7","P-Ext28","273","883","570"],
["PGC 58314","Sol-7","P-Ext27","358","886","563"],
["PGC 58314","Sol-7","P-FirX","323","826","557"],
["PGC 58314","Sol-7","P-Ext25","313","885","553"],
["PGC 58314","Sol-7","P-FirX","284","884","546"],
["PGC 58314","Sol-7","P-Jun23","230","868","542"],
["PGC 58314","Sol-7","P-Jun22","305","848","535"],
["PGC 58314","Sol-7","P-Jun21","330","877","528"],
["PGC 58314","Sol-7","P-Jun29","324","825","523"],
["PGC 58314","Sol-7","P-Fir19","204","843","517"],
["PGC 58314","Sol-7","P-Wat18","193","808","511"],
["PGC 58314","Sol-7","P-Fir17","234","817","505"],
["PGC 58314","Sol-7","P-Ext7","198","871","496"],
["PGC 58314","Sol-7","P-Sto14","226","818","491"],
["PGC 58314","Sol-7","P-Sto12","209","832","482"],
["PGC 58314","Sol-7","P-Sto11","264","827","477"],
["PGC 58314","Sol-7","P-Wat10","259","908","473"],
["PGC 58314","Sol-7","P-Des9","281","911","468"],
["PGC 58314","Sol-7","P-Des8","278","872","462"],
["PGC 58314","Sol-7","P-Des7","314","866","457"],
["PGC 58314","Sol-7","P-Fir6","349","857","453"],
["PGC 58314","Sol-7","P-Des4","265","866","441"],
["PGC 58314","Sol-7","P-Jun3","225","848","437"],
["PGC 58314","Sol-7","P-Sto2","317","807","430"],
["PGC 58314","Sol-7","P-Fir1","285","826","423"],
["PGC 58314","Sol-8","P-Wat18","963","527","377"],
["PGC 58314","Sol-8","P-Des4","887","528","374"],
["PGC 58314","Sol-8","P-Ext23","994","582","368"],
["PGC 58314","Sol-8","P-Jun19","970","627","368"],
["PGC 58314","Sol-8","P-Fir15","946","533","361"],
["PGC 58314","Sol-8","P-Sto16","951","546","357"],
["PGC 58314","Sol-8","P-Ext22","990","639","356"],
["PGC 58314","Sol-8","P-Des11","927","632","354"],
["PGC 58314","Sol-8","P-Fir1","871","587","345"],
["PGC 58314","Sol-8","P-Wat5","893","555","344"],
["PGC 58314","Sol-8","P-Jun17","956","564","340"],
["PGC 58314","Sol-8","P-Jun8","905","550","338"],
["PGC 58314","Sol-8","P-Ext24","1001","611","335"],
["PGC 58314","Sol-8","P-Fir9","916","512","331"],
["PGC 58314","Sol-8","P-Jun13","937","565","330"],
["PGC 58314","Sol-8","P-Jun10","923","632","305"],
["PGC 58314","Sol-8","P-Ext2","877","564","304"],
["PGC 58314","Sol-8","P-Fir20","976","511","298"],
["PGC 58314","Sol-8","P-Des6","899","641","290"],
["PGC 58314","Sol-8","P-Ext3","882","538","281"],
["PGC 58314","Sol-8","P-Sto12","932","572","276"],
["PGC 58314","Sol-8","P-Ext25","1007","608","275"],
["PGC 58314","Sol-8","P-Ext21","983","582","270"],
["PGC 58314","Sol-8","P-Wat8","909","624","269"],
["PGC 58314","Sol-8","P-Sto14","941","541","269"],
["PGC 58314","Sol-9","P-Jun19","239","629","92"],
["PGC 58314","Sol-9","P-Wat2","155","676","92"],
["PGC 58314","Sol-9","P-Ext21","250","653","88"],
["PGC 58314","Sol-9","P-Wat8","183","663","87"],
["PGC 58314","Sol-9","P-Des10","195","597","85"],
["PGC 58314","Sol-9","P-Ext15","220","708","81"],
["PGC 58314","Sol-9","P-Ext25","269","683","79"]
];

var suns = [["PGC 58314","Sol-1","S-Ora1","275","730","203"],
["PGC 58314","Sol-11","S-Red1","848","558","988"],
["PGC 58314","Sol-12","S-Yel1","453","1002","608"],
["PGC 58314","Sol-14","S-Red1","766","339","318"],
["PGC 58314","Sol-15","S-Yel1","528","798","395"],
["PGC 58314","Sol-16","S-Ora1","654","975","993"],
["PGC 58314","Sol-17","S-Red1","945","647","497"],
["PGC 58314","Sol-18","S-Red1","97","673","264"],
["PGC 58314","Sol-19","S-Yel1","197","1000","137"],
["PGC 58314","Sol-2","S-Red1","522","591","714"],
["PGC 58314","Sol-20","S-Yel1","824","784","288"],
["PGC 58314","Sol-21","S-Red1","672","526","337"],
["PGC 58314","Sol-22","S-Red1","904","689","125"],
["PGC 58314","Sol-23","S-Ora1","879","608","814"],
["PGC 58314","Sol-24","S-Ora1","1008","1007","866"],
["PGC 58314","Sol-25","S-Yel1","100","425","199"],
["PGC 58314","Sol-3","S-Red1","947","244","569"],
["PGC 58314","Sol-4","S-Red1","444","452","501"],
["PGC 58314","Sol-5","S-Yel1","424","400","214"],
["PGC 58314","Sol-6","S-Ora1","191","674","395"],
["PGC 58314","Sol-7","S-Yel1","270","845","495"],
["PGC 58314","Sol-8","S-Yel1","932","568","319"],
];

var test_sys = [["Test","Center","S-Center","500","500","500"],
["Test","ZUp","S-ZUp","500","500","750"],
["Test","ZDn","S-ZDn","500","500","250"],
["Test","YUp","S-YUp","500","750","500"],
["Test","YDn","S-YDn","500","250","500"],
["Test","XUp","S-XUp","750","500","500"],
["Test","XDn","S-XDn","250","500","500"],
];

// requestAnim shim layer by Paul Irish
// thanks to http://paulirish.com/2011/requestanimationframe-for-smart-animating/
window.requestAnimationFrame = (function()
{
    return  window.requestAnimationFrame ||
            window.webkitRequestAnimationFrame ||
            window.mozRequestAnimationFrame ||
            window.oRequestAnimationFrame ||
            window.msRequestAnimationFrame ||
            function(/* function */ callback, /* DOMElement */ element)
            {
                window.setTimeout(callback, 1000 / 60); // 16 ms = ~60 fps
            };
})();

var c=document.getElementById("spacemap");
var ctx=c.getContext("2d");
var cc=document.getElementById("spacemap_click");
var click_ctx=cc.getContext("2d");


// click_ctx = ctx; //DEBUG
var tooltip_active=false;

function spacemap_tooltip_start() {
  tooltip_active = true;
}

function spacemap_tooltip_stop() {
  tooltip_active = false;
}

function calc_dist(source, target) {
  return Math.sqrt(Math.pow(source.x - target.x , 2) + Math.pow(source.y - target.y , 2) + Math.pow(source.z - target.z , 2)).toFixed(3);
}



function spacemap_tooltip(e){
  if(!tooltip_active)
    return;

  if (!e) 
    var e = window.event;

  var offsetX = e.offsetX || e.pageX - e.originalTarget.offsetLeft;
  var offsetY = e.offsetY || e.pageY - e.originalTarget.offsetTop;
  var click_data = click_ctx.getImageData(0,0,cc.width, cc.height);
  var planet_id_offset = offsetY*cc.width*4 + offsetX*4;
  var planet_id = click_data.data[planet_id_offset+2] + click_data.data[planet_id_offset+1] *256;
  var fleet_id = click_data.data[planet_id_offset];
  var tooltip = document.getElementById("tooltip");
  if(planet_id == 0 && fleet_id == 0) {
    tooltip.style.display = "none";
    return;
  }
  if(planet_id != 0) {
    tooltip.innerHTML = positions[planet_id].slice(0,3).join("<br>")+"<br>("+positions[planet_id].slice(3,6).join(" / ")+")<br>Distance: "+calc_dist(current,{x:positions[planet_id][3], y:positions[planet_id][4], z:positions[planet_id][5]})+" pc";
  }
  if(fleet_id != 0) {
    var index = fleet_index[fleet_id];

    if(index > 0) {
      var this_fleet = fleets[index-1];
    } else {
      var this_fleet = myfleets[-1*index-1];
    }
    tooltip.innerHTML = this_fleet.name+"<br>"+this_fleet.state+"/"+this_fleet.mission+"<br>("+this_fleet.currentPosX+"/"+this_fleet.currentPosY+"/"+this_fleet.currentPosZ+")";
  }
  tooltip.style.display = "block";
  tooltip.style.top = e.pageY + "px";
  tooltip.style.left = e.pageX+20 + "px";

}

function spacemap_click(e){
  if (!e) 
    var e = window.event;

  var offsetX = e.offsetX || e.pageX - e.originalTarget.offsetLeft;
  var offsetY = e.offsetY || e.pageY - e.originalTarget.offsetTop;
  var click_data = click_ctx.getImageData(0,0,cc.width, cc.height);
  var planet_id_offset = offsetY*cc.width*4 + offsetX*4;
  var planet_id = click_data.data[planet_id_offset+2] + click_data.data[planet_id_offset+1] *256;

  if(planet_id == 0) {
    return;
  }
  target.x = parseInt(positions[planet_id][3]);
  target.y = parseInt(positions[planet_id][4]);
  target.z = parseInt(positions[planet_id][5]);
//   target.range = 200;
  if(fleet_overlay_active) {
    target.range -= 100;
  }
 
  animate_transition_start();
  
  
}


function draw_grid() {
  var i;
  ctx.beginPath(); 
  ctx.lineWidth = 2;
  ctx.strokeStyle="#333";
  for(i=0; i < 4; i += 1) {
    //horizontal line
    ctx.moveTo(10, 250+80*i);
    ctx.lineTo(620, 250+80*i);
    //vertical line line
    ctx.moveTo(10+203*i, 250);
    ctx.lineTo(10+203*i, 490);
  }
  ctx.stroke();

//These numbers are unnecessary
//   ctx.fillStyle="#555";
//   ctx.font="14px Georgia";
//   for(i=0; i<9; i+=1) {
//     ctx.fillText(i+1,110+(i%3)*203,295+Math.floor(i/3)*80);
//   }
}

function pad(n, width, z) {
  z = z || '0';
  n = n + '';
  return n.length >= width ? n : new Array(width - n.length + 1).join(z) + n;
}

function draw_stuff(list, options) {
  
  options = options || {};
//   options.range = options.range || "auto";
//   options.planets_base = options.planets_base || false;
  options.planets_base = current.range <= 200;
  var i;
  
  
  
  
//   var min = {x:Infinity, y:Infinity, z:Infinity};
//   var max = {x:-Infinity, y:-Infinity, z:-Infinity};
//   for(i = 0; i < list.length; i += 1) {
//     min.x = Math.min(min.x, parseInt(list[i][3])-50);
//     min.y = Math.min(min.y, parseInt(list[i][4])-50);
//     min.z = Math.min(min.z, parseInt(list[i][5])-50);
//     max.x = Math.max(max.x, parseInt(list[i][3])+50);
//     max.y = Math.max(max.y, parseInt(list[i][4])+50);
//     max.z = Math.max(max.z, parseInt(list[i][5])+50);
//   }
// 
//   if(options.range == "auto") { // calculate range so that current is in the middle
//     var scale = {x : Math.max(Math.abs(current.x-min.x),Math.abs(current.x-max.x))*2,
//       y : Math.max(Math.abs(current.y-min.y),Math.abs(current.y-max.y))*2,
//       z : Math.max(Math.abs(current.z-min.z),Math.abs(current.z-max.z))*2,
//     }
//   } else if (options.range == "fit") { //calculate range so that everything nicely fits into view 
//     var scale = {x : max.x - min.x,
//       y : max.y - min.y,
//       z : max.z - min.z,
//     }
//   } else {//preset range
//     var scale = {x : options.range*2,
//       y : options.range*2,
//       z : options.range*2,
//     }
//     var min = { x : current.x - options.range,
//       y : current.y - options.range,
//       z : current.z - options.range,
//     }
//   }

    var scale = current.range*2;

    var min = { x : current.x - current.range,
      y : current.y - current.range,
      z : current.z - current.range,
    }

  //Planet and sun radius
  //Temp for Testing
  var planet_min = parseInt(document.getElementById("planet_min").value);
  var planet_max = parseInt(document.getElementById("planet_max").value);
  var planet_size = current.range >= 550 ? planet_min : current.range <= 50 ? planet_max : planet_max-Math.floor( ((current.range-50)/500) * (planet_max-planet_min));
  var star_min = parseInt(document.getElementById("star_min").value);
  var star_max = parseInt(document.getElementById("star_max").value);
  var sun_size = current.range >= 550 ? star_min : current.range <= 50 ? star_max : star_max-Math.floor( ((current.range-50)/500) * (star_max-star_min));

  var textboxes = [];
  for(i = 0; i < list.length; i += 1) {
    var x = list[i][3];
    var y = list[i][4];
    var z = list[i][5];
    
    var angle = (current.angle % 360) / 180 * Math.PI;
    // rotate around current position
    //translate to origin, then rotate, then translate back;
    x -= current.x;
    y -= current.y;
    var xnew = x * Math.cos(angle) - y * Math.sin(angle);
    var ynew = y * Math.cos(angle) + x * Math.sin(angle);
    x = xnew + current.x;
    y = ynew + current.y;
    
    
    //Position calculations
    //magic numbers here are derived from canvas width and height, with a 10px padding
    var screen_x = 10+(x-min.x)*(610/scale);
    var screen_y = 250+(y-min.y)*(240/scale);
    var z_offset = (z-min.z)*(250/scale);
    
    if(screen_x > 620 || screen_y > 490 || screen_y-z_offset > 490)
      continue;
    if(screen_x < 10 || screen_y < 250 || screen_y-z_offset < 10)
      continue;

    //Note: This switch is only temporary. A field with the exact Object type will be needed.
    var sun = list[i][2].charAt(0) == "S";
    ctx.lineWidth = 1;
    if(sun) {
      //draw base for the sun
      ctx.strokeStyle="lime";
      ctx.save()
      ctx.beginPath();
      ctx.translate(screen_x,screen_y)
      ctx.scale(1,0.5);
      ctx.arc(0,0,sun_size/2,0,2*Math.PI);
      ctx.stroke();
      ctx.restore()
            
      ctx.beginPath();
      ctx.moveTo(screen_x,screen_y);
      ctx.lineTo(screen_x,screen_y-z_offset);
      ctx.stroke();

      //draw the sun
      //Note: This switch is only temporary. A field with the exact Object type will be needed.
      var sx = list[i][2] == "S-Ora1" ? 0 : ( list[i][2] == "S-Red1" ? 50 : 100 );
      ctx.drawImage(spritesheet,sx,300,50,50,Math.floor(screen_x-sun_size),Math.floor(screen_y-z_offset-sun_size),2*sun_size, 2*sun_size);

      //draw mouseover target on hidden canvas
      click_ctx.fillStyle="#"+pad(i.toString(16),6,"0");
      click_ctx.save()
      click_ctx.translate(Math.floor(screen_x),Math.floor(screen_y));
      click_ctx.scale(1,0.5);
      click_ctx.fillRect(-sun_size,-sun_size,2*sun_size, 2*sun_size);
      click_ctx.restore()

      click_ctx.fillRect(Math.floor(screen_x-sun_size),Math.floor(screen_y-z_offset-sun_size),2*sun_size, 2*sun_size);
      
      //textboxes drawn last
      textboxes.push([list[i][1],10+screen_x,15+screen_y-z_offset]);
      
    } else {
      // it's a planet!
      if(options.planets_base) {
	//the actual base
        ctx.strokeStyle="#070";
        ctx.save()
        ctx.beginPath();
        ctx.translate(screen_x,screen_y)
        ctx.scale(1,0.5);//make the circle an ellipse
        ctx.arc(0,0,planet_size/2,0,2*Math.PI);
        ctx.stroke();
        ctx.restore()
        
        //and the mouseover target of course
        click_ctx.fillStyle="#"+pad(i.toString(16),6,"0");;
        click_ctx.save()
        click_ctx.translate(Math.floor(screen_x),Math.floor(screen_y))
        click_ctx.scale(1,0.5);//make the circle an ellipse
        click_ctx.fillRect(-planet_size,-planet_size,2*planet_size, 2*planet_size);
        click_ctx.restore()
        
        ctx.beginPath();
        ctx.moveTo(screen_x,screen_y);
        ctx.lineTo(screen_x,screen_y-z_offset);
        ctx.stroke();

      }
      
      //draw the planet.
      //Note: This switch is only temporary. A field with the exact Object type will be needed.

      switch(list[i][2].charAt(2)) {
        case "D" :      var sy = 0; break;
        case "E" :      var sy = 50;break;
        case "F" :      var sy = 100; break;
        case "J" :      var sy = 150; break;
        case "S" :      var sy = 200; break;
        case "W" :      var sy = 250; break;
        default : var sy = 0;break;
      }
      ctx.drawImage(spritesheet,0/*replace by type soon*/,sy,50,50,Math.floor(screen_x-planet_size),Math.floor(screen_y-z_offset-planet_size),2*planet_size, 2*planet_size);
      
      //and the obligatory mouseover targets
      click_ctx.fillStyle="#"+pad(i.toString(16),6,"0");
      click_ctx.fillRect(Math.floor(screen_x-planet_size),Math.floor(screen_y-z_offset-planet_size),2*planet_size, 2*planet_size);

    }

  }
  //Now draw the Textboxes on top of everything
  ctx.font="14px Georgia";
  for(i = 0; i < textboxes.length; i += 1) {
    ctx.globalAlpha = 0.7;
    ctx.fillStyle="#999";
    ctx.fillRect(textboxes[i][1],textboxes[i][2]-13,ctx.measureText(textboxes[i][0]).width+4,18);
    ctx.globalAlpha = 1;
    ctx.fillStyle="yellow";
    ctx.fillText(textboxes[i][0],textboxes[i][1]+2, textboxes[i][2]);
  }

}

function redraw_from_values() {
  for(i in target) {
    target[i] = parseInt(document.getElementById("current_"+i).value);
  }
 
  animate_transition_start();
}

function animate_transition_start() {

  if(animation_blocked)
    return;
  fleet_overlay_active = false;
  check_values();
  animation_start = null;
    start.x = current.x;
    start.y = current.y;
    start.z = current.z;
    start.range = current.range;
    start.angle = current.angle;
  if(!animation_running) {
    animation_running = true
    requestAnimationFrame(animate_transition);
  }
}

function animate_transition(time) {
  if (animation_start === null) animation_start = time;
  for(i in current) {
    current[i] = easeInOutCubic(time-animation_start, start[i], target[i]- start[i] , animation_duration);
  }
  draw();

  if(time-animation_start < animation_duration) {
    requestAnimationFrame(animate_transition);
  } else {
    animation_running = false; // end the animation;
    for(i in current) {
      current[i] = target[i];
    }
    draw();
  }
  for(i in current) {
    document.getElementById("current_"+i).value = current[i];
  }
}

// http://www.gizma.com/easing/#cub3
// t: current time
// b: starting value
// c: delta value
// d: duration
easeInOutCubic = function (t, b, c, d) {
    t /= d/2;
    if (t < 1) return c/2*t*t*t + b;
    t -= 2;
    return c/2*(t*t*t + 2) + b;
};




function draw() {
  ctx.clearRect(0,0,630,500);
  click_ctx.clearRect(0,0,630,500);
  draw_grid();
  draw_stuff(positions, draw_options);
}

function check_values() {
  target.range = Math.ceil(target.range / 50) * 50; // round to full 50
  if(target.range <=50)
    target.range = 50;
  if(target.range >=2000)
    target.range = 2000;
  if((target.angle > 360 && current.angle > 360) || (target.angle < -360 && current.angle < -360) ) {
    target.angle %= 360;
    current.angle %= 360;
  }
  
}

function zoom_in() {
  target.range -= 100;
  animate_transition_start();
}

function zoom_out() {
  target.range += 100;
  animate_transition_start();
}

function rotate_left() {
  target.angle -= 60;
  animate_transition_start();
}
function rotate_right() {
  target.angle += 60;
  animate_transition_start();
}

function reset_view() {
  var min = {x:Infinity, y:Infinity, z:Infinity};
  var max = {x:-Infinity, y:-Infinity, z:-Infinity};
  for(i = 0; i < positions.length; i += 1) {
    min.x = Math.min(min.x, parseInt(positions[i][3])-50);
    min.y = Math.min(min.y, parseInt(positions[i][4])-50);
    min.z = Math.min(min.z, parseInt(positions[i][5])-50);
    max.x = Math.max(max.x, parseInt(positions[i][3])+50);
    max.y = Math.max(max.y, parseInt(positions[i][4])+50);
    max.z = Math.max(max.z, parseInt(positions[i][5])+50);
  }
  target.range = Math.max(max.x - min.x,max.y - min.y,max.z - min.z)/2;
  target.x = min.x+(max.x - min.x)/2;
  target.y = min.y+(max.y - min.y)/2;
  target.z = min.z+(max.z - min.z)/2;
  target.angle = 0;
  animate_transition_start();
}

function fleet_scan(){
  if(animation_running)
    return;
  if(fleet_overlay_active) {
    animate_transition_start();
    return;
  }
  if(current.range > 200) {
    target.angle=0;
    animate_transition_start();
  }
  fleet_scan_request_start();
  animate_fleet_scan_start();
}

function animate_fleet_scan_start()
{
  fleet_overlay_active = true;
  animation_blocked=true;
  animation_running = true;
  scan_animation_start = null;
  scan_animation_stop = false;
  scan_animation_duration = 600;
  scan_animation_step = 0;
  requestAnimationFrame(scan_grid);
}

function fleet_scan_request_start() {
//Do some AJAX here

//DUMMY CALLBACK
scan_timeout = setTimeout(function(){scan_animation_stop = 1; 
  if (fleets == undefined) { //pick some fleets somewhere
    fleets = [];
    myfleets = [];
    for( i = 0; i < 90; i += 1) {
      var r = Math.floor(Math.random()*positions.length);
      fleets.push({
      "planetId": null,
      "id": i,
      "name": "Flotte"+i,
      "state": "AtHome",
      "onVacation": "0",
      "mission": "NoMission",
      "canBeSupplied": 0,
      "canBeAttacked": 0,
      "canBeInspected": 0,
      "hiddenFleet": false,
      "isAlien": false,
      "destination": null,
      "currentPosX": positions[r][3],
      "currentPosY": positions[r][4],
      "currentPosZ": positions[r][5]
      });
    }
    for( i = 0; i < 10; i += 1) {
      var r = Math.floor(Math.random()*positions.length);
      myfleets.push({
      "planetId": null,
      "id": i,
      "name": "MeineFlotte"+i,
      "state": "AtHome",
      "onVacation": "0",
      "mission": "NoMission",
      "canBeSupplied": 0,
      "canBeAttacked": 0,
      "canBeInspected": 0,
      "hiddenFleet": false,
      "isAlien": false,
      "destination": null,
      "currentPosX": positions[r][3],
      "currentPosY": positions[r][4],
      "currentPosZ": positions[r][5]
      });
    }
  }
  fleet_sectors = [];
  for(i = 0; i < sector_number*sector_number; i += 1) {
    fleet_sectors.push({"my":0, "enemy":0});
  }
  var scale = current.range*2;

  var min = { x : current.x - current.range,
    y : current.y - current.range,
    z : current.z - current.range,
  }
  for( i = 0; i < fleets.length; i += 1) {
    var x = fleets[i].currentPosX;
    var y = fleets[i].currentPosY;
    var z = fleets[i].currentPosZ;
  
    var screen_x = 10+(x-min.x)*(610/scale);
    var screen_y = 250+(y-min.y)*(240/scale);
    var z_offset = (z-min.z)*(250/scale);
    if(screen_x > 620 || screen_y > 490 || screen_y-z_offset > 490)
      continue;
    if(screen_x < 10 || screen_y < 250 || screen_y-z_offset < 10)
      continue;
    var x_sector = Math.floor((screen_x-10) / (610/sector_number));
    var y_sector = Math.floor((screen_y-z_offset-10) / (480/sector_number));
    fleet_sectors[x_sector + sector_number * y_sector].enemy += 1;
  }
  for( i = 0; i < myfleets.length; i += 1) {
    var x = myfleets[i].currentPosX;
    var y = myfleets[i].currentPosY;
    var z = myfleets[i].currentPosZ;
  
    var screen_x = 10+(x-min.x)*(610/scale);
    var screen_y = 250+(y-min.y)*(240/scale);
    var z_offset = (z-min.z)*(250/scale);
    if(screen_x > 620 || screen_y > 490 || screen_y-z_offset > 490)
      continue;
    if(screen_x < 10 || screen_y < 250 || screen_y-z_offset < 10)
      continue;
    var x_sector = Math.floor((screen_x-10) / (610/sector_number));
    var y_sector = Math.floor((screen_y-z_offset-10) / (480/sector_number));
    fleet_sectors[x_sector + sector_number * y_sector].my += 1;
  }

}, 2000);
}

function draw_scan_grid(progress) {
  if(progress == undefined)
    progress = 1;

  ctx.strokeStyle="blue";
  ctx.lineWidth = 2;
  ctx.beginPath(); 
  for(i=10; i < 500; i += 480/sector_number) {
    ctx.moveTo(10, i);
    ctx.lineTo(620*progress, i);
  }
  for(i=10; i < 630; i += 610/sector_number) {
    ctx.moveTo(i, 10);
    ctx.lineTo(i,490*progress);
  }
  ctx.stroke();
}

function scan_grid(time){
  
  if (scan_animation_start === null) scan_animation_start = time;
  var i,animation_progress;
  ctx.globalAlpha = 0.4;

  draw();

  ctx.globalAlpha = 0.4;

  if(scan_animation_step == 0) {
    animation_progress = (time-scan_animation_start) / scan_animation_duration;
    if(animation_progress > 1)
      animation_progress = 1;
    if(animation_progress < 0)
      animation_progress = 0;
  } else {
    animation_progress = 1;
  }
  //   console.log(animation_progress,time,scan_animation_start);

  draw_scan_grid(animation_progress);

  if(scan_animation_step == 1) {
    ctx.fillStyle="blue";
//     ctx.globalAlpha = 1;


    ctx.globalAlpha = 0.5;
    ctx.globalCompositeOperation="lighter";
    ctx.fillRect(10+610/sector_number*scan_field.x,10+480/sector_number*scan_field.y,610/sector_number,480/sector_number);
//     scan_field.x = easeInOutCubic(time-scan_animation_start, scan_field.dir == 1 ? 1 : 43, scan_field.dir == 1 ? 42 : -42 , scan_animation_duration);
// 
//     ctx.fillRect(10+610/48*scan_field.x,10,610/12,480);
//     ctx.fillRect(10,10+480/48*scan_field.x,610,480/12);
//     ctx.fillRect(570-610/48*scan_field.x,10,610/12,480);
//     ctx.fillRect(10,440-480/48*scan_field.x,610,480/12);
  }
  ctx.globalCompositeOperation="source-over";

  ctx.globalAlpha = 1;
  ctx.strokeStyle="lime";
  ctx.font="bold 40px Courier New ";
  ctx.textAlign="center"; 
  ctx.strokeText("...SCANNING...",315,260);
  ctx.textAlign="start"; 

  if(time-scan_animation_start < scan_animation_duration) {
  } else {
    switch(scan_animation_step) {
      case 0: 
        scan_animation_step = 1; 
        scan_animation_start = null; 
//         scan_animation_duration = 3000; 
        scan_animation_duration = 100; 
        scan_field = {x : Math.floor(Math.random()*sector_number), y: Math.floor(Math.random()*sector_number), dir: 1};
      break;
        case 1:
        scan_animation_start = null; 
        scan_field = {x : Math.floor(Math.random()*sector_number), y: Math.floor(Math.random()*sector_number), dir: 1};
//         if(( scan_field.x == 5 && scan_field.dir == 1 ) || (scan_field.x == 0 && scan_field.dir == -1)) {
//           scan_field.y += 1;
//           if(scan_field.y == 6)
//             scan_field.y = 0;
//           scan_field.dir *= -1;
//         } else {
//           scan_field.x += scan_field.dir;
//         }
      break;
    }
  }

  if(!scan_animation_stop) {
    requestAnimationFrame(scan_grid);
  } else {
    ctx.globalAlpha = 0.4;
    draw();
    ctx.globalAlpha = 0.4;
    draw_scan_grid();
    ctx.globalAlpha = 1;
    animation_blocked = false;
    animation_running = false;
    if(scan_animation_stop == -1) { //ABORT
      draw();
      clearTimeout(scan_timeout);
      fleet_overlay_active = false;
    } else if(scan_animation_stop == 1) { //SUCCESS
      if (current.range > 200) {
        draw_fleet_numbers();
      } else {
        draw_fleet_positions();
      }
    }
    scan_animation_stop = false;

  }

}

function draw_fleet_numbers() {
  ctx.font="20px Courier New ";
  ctx.textAlign="center"; 
  for( i = 0; i < 36; i += 1) {
    if(fleet_sectors[i].enemy > 0) {
    ctx.lineWidth = 1;
    ctx.strokeStyle="red";
    ctx.strokeText(fleet_sectors[i].enemy,10+(i%sector_number)*(610/sector_number)+(610/sector_number/4),10+Math.floor(i/sector_number)*(480/sector_number)+(480/sector_number/4));
    ctx.lineWidth = 4;
    ctx.beginPath();
    ctx.arc(10+(i%sector_number)*(610/sector_number)+(610/sector_number/4),10+Math.floor(i/sector_number)*(480/sector_number)+(480/sector_number/4)-6,18,0,2*Math.PI);
    ctx.stroke();
    }
    if(fleet_sectors[i].my > 0) {
    ctx.lineWidth = 1;
    ctx.strokeStyle="#0f0";
    ctx.strokeText(fleet_sectors[i].my,10+(i%sector_number)*(610/sector_number)+(610/sector_number/4*3),10+Math.floor(i/sector_number)*(480/sector_number)+(480/sector_number/4*3));
    ctx.lineWidth = 4;
    ctx.beginPath();
    ctx.arc(10+(i%sector_number)*(610/sector_number)+(610/sector_number/4*3),10+Math.floor(i/sector_number)*(480/sector_number)+(480/sector_number/4*3)-6,18,0,2*Math.PI);
    ctx.stroke();
    }
  }
  ctx.textAlign="start"; 
}

function draw_fleet_positions() {
  var scale = current.range*2;

  var min = { x : current.x - current.range,
    y : current.y - current.range,
    z : current.z - current.range,
  }

  ctx.lineWidth = 2;
  ctx.fillStyle = "red";
  fleet_index = [0];
  var index_number = 1;
  for( i = 0; i < fleets.length; i += 1) {
    var x = fleets[i].currentPosX;
    var y = fleets[i].currentPosY;
    var z = fleets[i].currentPosZ;
    var angle = (current.angle % 360) / 180 * Math.PI;
    // rotate around current position
    //translate to origin, then rotate, then translate back;
    x -= current.x;
    y -= current.y;
    var xnew = x * Math.cos(angle) - y * Math.sin(angle);
    var ynew = y * Math.cos(angle) + x * Math.sin(angle);
    x = xnew + current.x;
    y = ynew + current.y;
  
    var screen_x = 10+(x-min.x)*(610/scale);
    var screen_y = 250+(y-min.y)*(240/scale);
    var z_offset = (z-min.z)*(250/scale);
    if(screen_x > 620 || screen_y > 490 || screen_y-z_offset > 490)
      continue;
    if(screen_x < 10 || screen_y < 250 || screen_y-z_offset < 10)
      continue;
    ctx.fillRect(Math.floor(screen_x-10),Math.floor(screen_y-z_offset-10),6,6)
    click_ctx.fillStyle = "#"+pad(index_number.toString(16),2,"0")+"0000";
    fleet_index.push((i+1));
    index_number += 1;
    click_ctx.fillRect(Math.floor(screen_x-10),Math.floor(screen_y-z_offset-10),6,6)
    

  }
  ctx.fillStyle = "#0f0";
  for( i = 0; i < myfleets.length; i += 1) {
    var x = myfleets[i].currentPosX;
    var y = myfleets[i].currentPosY;
    var z = myfleets[i].currentPosZ;
    var angle = (current.angle % 360) / 180 * Math.PI;
    // rotate around current position
    //translate to origin, then rotate, then translate back;
    x -= current.x;
    y -= current.y;
    var xnew = x * Math.cos(angle) - y * Math.sin(angle);
    var ynew = y * Math.cos(angle) + x * Math.sin(angle);
    x = xnew + current.x;
    y = ynew + current.y;
  
    var screen_x = 10+(x-min.x)*(610/scale);
    var screen_y = 250+(y-min.y)*(240/scale);
    var z_offset = (z-min.z)*(250/scale);

    if(screen_x > 620 || screen_y > 490 || screen_y-z_offset > 490)
      continue;
    if(screen_x < 10 || screen_y < 250 || screen_y-z_offset < 10)
      continue;
    ctx.fillRect(Math.floor(screen_x+10),Math.floor(screen_y-z_offset+10),6,6)
    click_ctx.fillStyle = "#"+pad(index_number.toString(16),2,"0")+"0000";
    fleet_index.push(-1*(i+1));
    index_number += 1;
    click_ctx.fillRect(Math.floor(screen_x+10),Math.floor(screen_y-z_offset+10),6,6)
  }
}

function fleet_scan_abort() {
  scan_animation_stop = -1;
}

var scan_animation_start, scan_animation_duration, scan_animation_step, scan_animation_stop = false, scan_field, scan_timeout, fleet_overlay_active = false;

var animation_start;
var animation_running;
var animation_blocked=false;
var animation_duration = 2000; //3 sec ?
var draw_options = {planets_base: false};
var target = {x:727,y:945,z:1032, range: 800, angle: 0};
var current = {x:727, y: 945, z: 1032, range: 10, angle: 180};
var start = {x:500, y: 500, z: 500, range: 2000, angle: 0};
document.getElementById("current_x").value = current.x;
document.getElementById("current_y").value = current.y;
document.getElementById("current_z").value = current.z;
// positions = test_sys;
positions.sort(function(a,b){return a[4] - b[4]});//sort by y coordinate

var spritesheet = new Image()
spritesheet.src = "planets.png";
spritesheet.onload = reset_view;

</script>
</body>
